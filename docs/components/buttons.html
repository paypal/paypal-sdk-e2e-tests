<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <link rel="stylesheet" href="style.css" />
        <title>PayPal JS SDK Buttons Test Page</title>
    </head>
    <body>
        <h1>PayPal JS SDK Buttons Test Page</h1>
        <table class="table" style="max-width: 500px">
            <tbody>
                <tr>
                    <th width="50%">SDK Version</th>
                    <td data-testid="sdk-version"></td>
                </tr>
                <tr>
                    <th>SDK Load Time</th>
                    <td data-testid="sdk-load-time"></td>
                </tr>
                <tr>
                    <th>Order ID</th>
                    <td data-testid="order-id"></td>
                </tr>
                <tr>
                    <th>On Approve Message</th>
                    <td data-testid="order-approve-message"></td>
                </tr>
            </tbody>
        </table>

        <div id="buttons-container"></div>
        <script type="module">
            import { loadScript } from "https://unpkg.com/@paypal/paypal-js@4.1.0/dist/esm/paypal-js.js";
            import {
                getOptionsFromQueryString,
                getSDKScriptPerformance,
                setInnerHTML,
            } from "../utils.js";

            const options = {
                "client-id": "test",
                ...getOptionsFromQueryString(),
            };

            function createOrderCallback(data, actions) {
                return actions.order
                    .create({
                        purchase_units: [
                            {
                                amount: {
                                    value: 2.0,
                                },
                            },
                        ],
                    })
                    .then((orderID) => {
                        setInnerHTML("[data-testid='order-id']", orderID);
                        setInnerHTML(
                            "[data-testid='order-approve-message']",
                            ""
                        );
                        return orderID;
                    });
            }

            function onApproveCallback(data, actions) {
                return actions.order.capture().then((details) => {
                    setInnerHTML(
                        "[data-testid='order-approve-message']",
                        `Transaction completed by ${details.payer.name.given_name}`
                    );
                });
            }

            loadScript(options).then((paypal) => {
                setInnerHTML("[data-testid='sdk-version']", paypal.version);
                const sdkScriptPerformance = getSDKScriptPerformance();

                if (sdkScriptPerformance) {
                    setInnerHTML(
                        "[data-testid='sdk-load-time']",
                        `${Math.round(
                            sdkScriptPerformance.duration
                        )} milliseconds`
                    );
                }

                paypal
                    .Buttons({
                        createOrder: createOrderCallback,
                        onApprove: onApproveCallback,
                    })
                    .render("#buttons-container");
            });
        </script>
    </body>
</html>
